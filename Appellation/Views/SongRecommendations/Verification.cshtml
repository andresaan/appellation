@using Data.Seed;
@model SeedVerificationModel

@section scripts {

    <script>

        var artistVerifiedSeeds = [];

        var trackVerifiedSeeds = [];

        function verifyArtist(event) {

            var radioContainer = event.target.closest("div");
            var inputs = radioContainer.getElementsByTagName("input");

            for (var input of inputs) {

                var type = input.type;
                var value = input.value;

                if (input.checked && type == "radio") {

                    artistVerifiedSeeds.push(value);

                }

                if (!input.checked && artistVerifiedSeeds.includes(value)) {

                    artistVerifiedSeeds.splice(artistVerifiedSeeds.indexOf(value), 1);

                }
            }
        }

        function verifyTrack(event) {

            var radioContainer = event.target.closest("div");
            var inputs = radioContainer.getElementsByTagName("input");

            for (var input of inputs) {

                var type = input.type;
                var value = input.value;

                if (input.checked && type == "radio") {

                    trackVerifiedSeeds.push(value);

                }

                if (!input.checked && trackVerifiedSeeds.includes(value)) {

                    trackVerifiedSeeds.splice(trackVerifiedSeeds.indexOf(value), 1);

                }
            }
        }

        function setValues() {

            var artistSeedsJoined = artistVerifiedSeeds.join();
            var artistOutput = document.getElementById("verified-artist-output");

            artistOutput.value = artistSeedsJoined;

            var trackSeedsJoined = trackVerifiedSeeds.join();
            var trackOutput = document.getElementById("verified-track-output");

            trackOutput.value = trackSeedsJoined;

        }


    </script>

}

<link rel="stylesheet" href="~/css/Verify.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/SongRec.css" asp-append-version="true" />



<div class="song-rec-wrapper">
    <main class="recommendations">
        <div>
            <form class="verification" asp-controller="SongRecommendations" asp-action="Index">
                @for (var i = 0; i < Model.ArtistSeedIntermediaries.Count(); i++)
                {
                    <div class="theme-container">
                        <div>
                            <p>Verify which artist you would like to use for inspiration when generating your song recommendations</p>
                        </div>

                        <div class="d-flex flex-row">

                            @for (var j = 0; j < Model.ArtistSeedIntermediaries[i].PotentialSeeds.Count(); j++)
                            {
                                <input class="invisible-radio" type="radio" name="artist-seed-@i" id="artist-seed-@i-@j" value="@Model.ArtistSeedIntermediaries[i].PotentialSeeds[j].SpotifyId" onchange="verifyArtist(event)" />

                                <label for="artist-seed-@i-@j">
                                    <div class="card styled-radio">
                                        <div class="card-body">
                                            <img src="@Model.ArtistSeedIntermediaries[i].PotentialSeeds[j].Images[0].Url" width="275" height="275" alt="Album cover art" />
                                            <h5 class="card-title">@Model.ArtistSeedIntermediaries[i].PotentialSeeds[j].ArtistName</h5>
                                        </div>
                                    </div>
                                </label>
                            }
                        </div>
                    </div>
                }

                @for (var i = 0; i < Model.TrackSeedIntermediaries.Count(); i++)
                {
                    <div class="theme-container">
                        <div>
                            <p>Verify which track you would like to use for inspiration when generating your song recommendations</p>
                        </div>

                        <div class="d-flex flex-row">

                            @for (var j = 0; j < Model.TrackSeedIntermediaries[i].TrackPotentialSeeds.Count(); j++)
                            {
                                <input class="invisible-radio" type="radio" name="track-seed-@i" id="track-seed-@i-@j" value="@Model.TrackSeedIntermediaries[i].TrackPotentialSeeds[j].SpotifyId" onchange="verifyTrack(event)" />

                                <label for="track-seed-@i-@j">
                                    <div class="card styled-radio">
                                        <div class="card-body">
                                            <img src="@Model.TrackSeedIntermediaries[i].TrackPotentialSeeds[j].Images[0].Url" width="275" height="275" alt="Album cover art" />
                                            <h5 class="card-title">Track Name: @Model.TrackSeedIntermediaries[i].TrackPotentialSeeds[j].TrackName</h5>
                                            <h6 class="card-subtitle">Performing Artist: @Model.TrackSeedIntermediaries[i].TrackPotentialSeeds[j].PerformingArtist</h6>
                                        </div>
                                    </div>
                                </label>
                            }
                        </div>
                    </div>
                }

                @if (Model.GenreVerifiedSeeds != "")
                {
                    <div>
                        <label asp-for="@Model.GenreVerifiedSeeds">Genre(s) Being Used: @Model.GenreVerifiedSeeds</label>
                        <input type="hidden" asp-for="@Model.GenreVerifiedSeeds" value="@Model.GenreVerifiedSeeds" />
                    </div>
                }

                <input type="hidden" asp-for="@Model.TrackVerifiedSeeds" id="verified-track-output" />
                <input type="hidden" asp-for="@Model.ArtistVerifiedSeeds" id="verified-artist-output" />

                <input type="submit" onclick="setValues()" class="submit"/>
            </form>

            <button>Go Back</button>
        </div>
    </main>
</div>


